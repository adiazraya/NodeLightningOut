var cookieNameTIME;var cookieNamePersonalization;var endpointAuthTIME;var clientIdTIME;var cookieExpirationTIME;var redirectUriTIME=window.location.origin+"/delegate/time-callback-servlet";jQuery(document).ready(function(){cookieNameTIME=jQuery("[id$='cookieNameTIME']").val();cookieNamePersonalization=jQuery("[id$='cookieNamePersonalization']").val();endpointAuthTIME=jQuery("[id$='endpointAuthTIME']").val();clientIdTIME=jQuery("[id$='clientIdTIME']").val();cookieExpirationTIME=jQuery("[id$='cookieExpiration']").val();readUserSegmentCookie()});function readUserSegmentCookie(){var a=document.cookie.match("(^|;) ?"+cookieNameTIME+"=([^;]*)(;|$)");var b=a?a[2]:null;if(b==null){if(Liferay.Browser.isMobile()){console.info("TIME: mobile device!");timeEndpointAuth()}else{console.info("TIME: NOT mobile device!");if(window.userSettingsPortlet_forceSettings){userSettingsPortlet_forceSettings(undefined,undefined)}}}else{console.info("cookieTIME detected!")}}function timeEndpointAuth(){console.info("ajaxTIME");jQuery.ajax({url:endpointAuthTIME,type:"get",dataType:"jsonp",jsonp:"state",data:{client_id:clientIdTIME,redirect_uri:redirectUriTIME},cache:false,success:function(b,c,a){if(b!=undefined&&b!=null&&b!=""){console.info("ajaxTIME ok: {msisdn:"+b.msisdn+",segment:"+b.user_segment+"}");createUserSegmentCookie(cookieNameTIME,b.user_segment,cookieExpirationTIME);if(window.userSettingsPortlet_forceSettings){userSettingsPortlet_forceSettings(b.msisdn,b.user_segment)}else{createUserSegmentCookie(cookieNamePersonalization,b.msisdn,cookieExpirationTIME)}}else{console.info("ajaxTIME ok: unknow user");if(window.userSettingsPortlet_forceSettings){userSettingsPortlet_forceSettings(undefined,undefined)}}},error:function(a,c,b){console.error("ajaxTIME error!")}})}function createUserSegmentCookie(a,b,c){if(c){date=new Date();date.setTime(date.getTime()+(c*24*60*60*1000));expires="; expires="+date.toUTCString()}else{expires=""}document.cookie=a+"="+b+expires+";path=/"};